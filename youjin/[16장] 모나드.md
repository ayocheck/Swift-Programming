### 컨텍스트란?

- 사전적인 의미는 `맥락`, `전후 사정`
- 프로그래밍에서는 컨텐츠를 담는 무언가를 뜻함
- Swift에서는 Optional이 대표적인 예시로 활용됨

```markdown
┌─────────────────┐
│   Optional<T>   │  ← 컨텍스트 (상자)
│  ┌───────────┐  │
│  │     T     │  │  ← 실제 값
│  └───────────┘  │
└─────────────────┘
```

### 함수 객체란? ⇒ map()

- 컨텍스트를 유지한 채로 값을 변환할 수 있는 컨테이너 타입
- 컨테이너의 값은 변경하되, **컨테이너 구조는 그대로 유지**

```markdown
┌─────────────────┐    map(+3)    ┌─────────────────┐
│   Optional(2)   │ ──────────→   │   Optional(5)   │
│  ┌───────────┐  │               │  ┌───────────┐  │
│  │     2     │  │               │  │     5     │  │
│  └───────────┘  │               │  └───────────┘  │
└─────────────────┘               └─────────────────┘
```

- Optional의 map 메서드 구현

```swift
extension Optional {
    func map<U>(f: (Wrapped) -> U) -> U? {
        switch self {
        case .some(let x): 
            return f(x)  // 값이 있으면 함수 적용
        case .none: 
            return .none // nil이면 nil 반환
        }
    }
}
```

### 모나드란?

- 컨텍스트라는 상자 안에서 안전하게 데이터를 다루는 디자인 패턴 or 자료 구조
- 함수 객체 중 자신과 같은 컨텍스트 형태를 반환할 수 있는 함수 객체 (닫힌 함수 객체)

### 모나드의 조건 3가지

- 타입을 인자로 받는 타입 (특정 타입의 값을 포장)
- 특정 타입의 값을 포장한 것을 반환하는 함수(메서드)가 존재 → map
- 포장된 값을 변환하여 같은 형태로 포장하는 함수(메서드)가 존재 → flatMap()

### flatMap (=compactMap())

- 컨텍스트의 포장된 값을 처리해 포장된 값을 컨텍스트에 다시 반환하는 함수 map
- 이 매핑의 결과가 함수 객체와 같은 컨텍스트를 반환하는 함수 객체 모나드
- 이 매핑을 수행하도록 활용하는 메서드 flatMap
- map과 달리 컨텍스트 내부의 컨텍스트를 모두 같은 위상으로 평평하게 펼쳐줌
    - 포장된 값 내부의 포장된 값의 포장을 풀어서 같은 위상으로 펼쳐준다는 뜻

### map vs flatMap

- map은 단순 변환 시 사용
- flatMap은 실패 가능한 변환 또는 중첩 제거 시 사용
