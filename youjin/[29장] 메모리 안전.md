## 메모리 안전(Memory Safety)
- 스위프트는 안전을 중요시하는 언어라서 컴파일러가 코드에서 위험을 줄일 수 있도록 많은 장치를 두고 있음
- 그중 큰 부분을 차지하는 것이 메모리의 안전한 접근이며, 변수를 사용하기 전에 초기화를 강제하고 해제된 메모리에 접근할 수 없도록 설계

## 메모리 접근 충돌
- 서로 다른 코드에서 동시에 같은 위치의 메모리에 접근(변수 할당, 매개변수 전달 등)할 때 발생
- 다중 스레드 프로그램에서 흔하게 일어남

### 메모리 접근 충돌을 일으키는 메모리 접근
- 세 가지 조건에 모두 해당하는 메모리 접근이 두 군데 이상의 코드에서 동시에 일어나면 메모리 접근 충돌 발생
  - **최소한 한 곳에서 쓰기 접근**
  - **같은 메모리 위치에 접근**
  - **접근 타이밍이 겹침**

## 장기적 메모리 접근
- 장기적 메모리 접근 중에는 해당 메모리 접근이 끝나기 전에 다른 코드에서 메모리에 접근할 가능성이 있음
    - inout을 사용한 입출력 매개변수 사용, 구조체에서 mutating 키워드를 사용하는 가변 메서드를 사용하는 경우
    - 단일 스레드 환경에서는 대부분의 메모리 접근이 순간적 접근
- 무조건적으로 발생하는 건 아니지만 접근 타이밍이 겹치면 발생
- 코드에서 정적으로 예측할 수 있는 경우 컴파일러에서 오류로 취급하여 컴파일하지 않음

### 입출력 매개변수에서의 메모리 접근 충돌
- 입출력 매개변수를 갖는 함수는 함수의 실행과 동시에 입출력 매개변수의 쓰기 접근이 시작, 함수가 종료될 때까지 유지
```swift
var step: Int = 1

func increment(_ number: inout Int) {
    number + = step
}
increment (&step) / / 오류 발생!
```
- 입출력 매개변수로 전달된 step 변수가 함수 내부에서 같은 메모리 공간에 읽기 접근을 시도한 경우

### 가변 메서드에서의 self 접근 충돌
- 구조체의 가변 메서드는 메서드 실행 중에 self에 쓰기 접근
- 입출력 매개변수로 전달받은 메모리 위치와 인스턴스의 메모리 위치가 같으면 동시에 쓰기 접근을 해서 충돌 발생할 수 있음

### 프로퍼티 접근 중 충돌
- 구조체나 열거형 등은 프로퍼티로 구성, 튜플은 요소의 모임으로 구성
    - 이 프로퍼티나 요소는 각각 독립적인 값을 가진 타입의 구성 요소이며 구조체, 열거형, 튜플 등은 값 타입
- 인스턴스 내부의 프로퍼티를 변경한다는 건 자신 스스로의 값을 변경한다는 것
    - 즉, 프로퍼티에 읽고 쓰기 위한 접근을 하는 건 인스턴스 자신 전체에 대한 읽고 쓰기 권한이 필요하다는 것

### 메모리 접근 안전 조건
- **연산 프로퍼티나 클래스 프로퍼티가 아닌 인스턴스의 저장 프로퍼티만 접근**
- **전역변수가 아닌 지역변수일 때**
- **클로저에 의해 획득(Captured)되지 않았거나 비탈출 클로저에 의해서만 획득되었을 때**
- 위 세 조건 충족 시 프로퍼티 메모리에 동시에 접근해도 안전 보장
